<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Stellar Events API</title>
<style>
*,*::before,*::after{box-sizing:border-box}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:#0f1117;color:#e1e4e8;line-height:1.6}
a{color:#58a6ff;text-decoration:none}
a:hover{text-decoration:underline}
.container{max-width:960px;margin:0 auto;padding:24px 20px}
header{border-bottom:1px solid #30363d;padding-bottom:20px;margin-bottom:32px}
header h1{margin:0 0 6px;font-size:28px;color:#f0f6fc}
header p{margin:0;color:#8b949e;font-size:15px}
.build-info{display:flex;align-items:center;gap:8px;margin-top:10px;font-size:13px;color:#8b949e}
.build-info a{color:#58a6ff;display:flex;align-items:center;gap:4px}
.build-info a:hover{color:#79c0ff}
.build-info .sep{color:#30363d}
.build-info code{font-size:12px;color:inherit;background:none;border:none;padding:0}
h3{font-size:16px;color:#c9d1d9;margin:20px 0 8px}
code{background:#161b22;border:1px solid #30363d;border-radius:4px;padding:2px 6px;font-size:13px;font-family:"SF Mono",Consolas,"Liberation Mono",Menlo,monospace;color:#79c0ff}
pre{background:#161b22;border:1px solid #30363d;border-radius:6px;padding:14px;overflow-x:auto;font-size:13px;font-family:"SF Mono",Consolas,"Liberation Mono",Menlo,monospace;color:#c9d1d9;line-height:1.5}
table{width:100%;border-collapse:collapse;margin:8px 0 16px;font-size:14px}
th,td{text-align:left;padding:8px 12px;border:1px solid #21262d}
th{background:#161b22;color:#8b949e;font-weight:600;font-size:12px;text-transform:uppercase;letter-spacing:.5px}
td code{border:none;padding:0;background:none;color:#79c0ff}
.method{display:inline-block;font-size:12px;font-weight:700;padding:2px 8px;border-radius:4px;margin-right:8px;font-family:"SF Mono",Consolas,monospace}
.method-get{background:#1f6feb22;color:#58a6ff;border:1px solid #1f6feb44}
.method-post{background:#23863622;color:#3fb950;border:1px solid #23863644}
details{border:1px solid #21262d;border-radius:8px;margin-bottom:12px;background:#161b2208}
details[open]{background:#161b2220}
summary{cursor:pointer;padding:14px 16px;font-size:15px;font-weight:600;color:#f0f6fc;list-style:none;display:flex;align-items:center;gap:8px;user-select:none}
summary::-webkit-details-marker{display:none}
summary::before{content:'';display:inline-block;width:0;height:0;border:5px solid transparent;border-left:6px solid #8b949e;transition:transform .15s}
details[open]>summary::before{transform:rotate(90deg)}
summary:hover{background:#21262d40}
summary p{margin:0;color:#8b949e;font-size:13px;font-weight:400;margin-left:auto}
.endpoint-body{padding:0 16px 16px}
.tabs{display:flex;gap:0;border-bottom:2px solid #21262d;margin-bottom:0}
.tab{padding:8px 16px;cursor:pointer;color:#8b949e;font-size:14px;border:none;background:none;border-bottom:2px solid transparent;margin-bottom:-2px;transition:color .15s,border-color .15s}
.tab:hover{color:#c9d1d9}
.tab.active{color:#f0f6fc;border-bottom-color:#58a6ff}
.tab-panel{display:none;padding:16px 0}
.tab-panel.active{display:block}
.toggle-row{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.toggle-btn{padding:4px 12px;font-size:13px;font-weight:600;border:1px solid #30363d;background:#21262d;color:#8b949e;cursor:pointer;border-radius:4px;font-family:"SF Mono",Consolas,monospace;transition:all .15s}
.toggle-btn.active{background:#1f6feb;border-color:#1f6feb;color:#fff}
.request-area{width:100%;background:#0d1117;border:1px solid #30363d;border-radius:6px;color:#c9d1d9;font-family:"SF Mono",Consolas,"Liberation Mono",Menlo,monospace;font-size:13px;padding:12px;resize:none;overflow:hidden;line-height:1.5}
.submit-btn{margin-top:10px;padding:6px 20px;font-size:14px;font-weight:600;background:#238636;color:#fff;border:1px solid #2ea04366;border-radius:6px;cursor:pointer;transition:background .15s}
.submit-btn:hover{background:#2ea043}
.submit-btn:disabled{opacity:.5;cursor:not-allowed}
.response-area{margin-top:12px}
.response-area pre{max-height:400px;overflow-y:auto;margin:0}
.response-label{font-size:12px;color:#8b949e;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
.response-time{float:right;font-variant-numeric:tabular-nums;color:#58a6ff}
.curl-area{margin-top:8px}
.curl-label{font-size:12px;color:#8b949e;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;display:flex;align-items:center;gap:8px}
.curl-area pre{margin:0;white-space:pre-wrap;word-break:break-all;font-size:12px;padding:10px;cursor:pointer;position:relative}
.curl-area pre:hover{border-color:#58a6ff}
.copy-hint{font-size:11px;color:#484f58;font-weight:400;text-transform:none;letter-spacing:0}
.spinner{display:none;width:16px;height:16px;border:2px solid #30363d;border-top-color:#58a6ff;border-radius:50%;animation:spin .6s linear infinite;margin-left:8px;vertical-align:middle}
@keyframes spin{to{transform:rotate(360deg)}}
.filter-table td{vertical-align:top}
.example-list{list-style:none;padding:0;margin:8px 0 16px}
.example-list li{margin-bottom:10px}
.example-list .example-desc{font-size:13px;color:#8b949e;margin-bottom:4px}
.example-list pre{margin:0;padding:10px 14px;font-size:13px;white-space:pre-wrap;word-break:break-all}
.example-list li{position:relative}
.try-it-link{position:absolute;top:0;right:0;font-size:12px;color:#58a6ff;font-weight:600}
.try-it-link:hover{color:#79c0ff}
.query-input-label{font-size:12px;color:#8b949e;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
.request-area[readonly]{background:#0d1117;color:#8b949e;cursor:default}
</style>
</head>
<body>
<div class="container">

<header>
  <h1>Stellar Events API</h1>
  <p>Query Stellar contract events via a paginated REST API. Filter by event type, contract, transaction, and topic patterns.</p>
  <div class="build-info" id="build-info"></div>
</header>

<!-- GET/POST /events -->
<details open>
  <summary>
    <span class="method method-get">GET</span>
    <span class="method method-post">POST</span>
    <code>/events</code>
    <p>List events with filters and pagination</p>
  </summary>
  <div class="endpoint-body">

  <p>Both methods accept the same fields — GET uses query parameters, POST uses a JSON body.</p>
  <table>
    <tr><th>Parameter</th><th>Type</th><th>Description</th></tr>
    <tr><td><code>limit</code></td><td>integer</td><td>Number of events to return (1–100, default 10)</td></tr>
    <tr><td><code>after</code></td><td>string</td><td>Return events newer than this cursor (event <code>id</code>)</td></tr>
    <tr><td><code>before</code></td><td>string</td><td>Return events older than this cursor (event <code>id</code>). Use the <code>next</code> field from a previous response to paginate.</td></tr>
    <tr><td><code>q</code></td><td>string or object</td><td>Filter query — a string (GET &amp; POST) or a <a href="/schema">JSON object</a> (POST only). See syntax below.</td></tr>
  </table>

  <h3 id="query-syntax">Query Syntax (<code>q</code> parameter)</h3>
  <p>Filter events using <code>key:value</code> qualifiers. Space-separated qualifiers are AND'd. Use <code>OR</code> for alternatives. Parentheses group expressions.</p>
  <table>
    <tr><th>Key</th><th>Value</th><th>Example</th></tr>
    <tr><td><code>type</code></td><td><code>contract</code> or <code>system</code></td><td><code>type:contract</code></td></tr>
    <tr><td><code>contract</code></td><td>Stellar contract strkey (C…)</td><td><code>contract:CCW67...</code></td></tr>
    <tr><td><code>ledger</code></td><td>Ledger sequence number</td><td><code>ledger:58000000</code></td></tr>
    <tr><td><code>tx</code></td><td>Transaction hash (requires <code>ledger</code>)</td><td><code>tx:abc123...</code></td></tr>
    <tr><td><code>topic</code></td><td>XDR-JSON ScVal object</td><td><code>topic:{"symbol":"transfer"}</code></td></tr>
    <tr><td><code>topic0</code>…<code>topic3</code></td><td>XDR-JSON ScVal object</td><td><code>topic0:{"symbol":"transfer"}</code></td></tr>
  </table>
  <h3 id="examples">Examples</h3>
  <ul class="example-list">
    <li>
      <div class="example-desc">All contract events from a ledger</div>
      <a href="#panel-byquery" class="try-it-link">try it &#x2192;</a>
      <pre>ledger:58000000 type:contract</pre>
    </li>
    <li>
      <div class="example-desc">Transfer events for a contract</div>
      <a href="#panel-byquery" class="try-it-link">try it &#x2192;</a>
      <pre>contract:CBN3Y5KABXEF2VDO7HNNT43TXSNL3KWTJC2HQY4ENVVRSRXFJJBFNKSM topic0:{"symbol":"transfer"}</pre>
    </li>
    <li>
      <div class="example-desc">Events from a specific transaction</div>
      <a href="#panel-byquery" class="try-it-link">try it &#x2192;</a>
      <pre>ledger:58000000 tx:7758a34695323011e177c932cb899f3ea55c5af4d95c954e946ddddaafca0296</pre>
    </li>
    <li>
      <div class="example-desc">Transfer, mint, clawback, and burn events for XLM and USDC</div>
      <a href="#panel-byquery" class="try-it-link">try it &#x2192;</a>
      <pre>(contract:CAS3J7GYLGXMF6TDJBBYYSE3HQ6BBSMLNUQ34T6TZMYMW2EVH34XOWMA OR contract:CCW67TSZV3SSS2HXMBQ5JFGCKJNXKZM7UQUWUZPUTHXSTZLEO7SJMI75) (topic0:{"symbol":"transfer"} OR topic0:{"symbol":"mint"} OR topic0:{"symbol":"clawback"} OR topic0:{"symbol":"burn"})</pre>
    </li>
    <li>
      <div class="example-desc">Events where a specific address appears in any topic position</div>
      <a href="#panel-byquery" class="try-it-link">try it &#x2192;</a>
      <pre>contract:CCW67TSZV3SSS2HXMBQ5JFGCKJNXKZM7UQUWUZPUTHXSTZLEO7SJMI75 topic:{"address":"GABC..."}</pre>
    </li>
  </ul>

  <h3 id="json-query-syntax">JSON Query Syntax (POST only)</h3>
  <p>In POST requests, <code>q</code> can also be a structured JSON object. The format uses <code>and</code>/<code>or</code> nodes and single-key qualifier objects. See the <a href="/schema">JSON Schema</a>.</p>
  <table>
    <tr><th>String syntax</th><th>JSON syntax</th></tr>
    <tr><td><code>type:contract</code></td><td><code>{"type":"contract"}</code></td></tr>
    <tr><td><code>type:contract contract:CCW67...</code></td><td><code>{"and":[{"type":"contract"},{"contract":"CCW67..."}]}</code></td></tr>
    <tr><td><code>type:contract OR type:system</code></td><td><code>{"or":[{"type":"contract"},{"type":"system"}]}</code></td></tr>
    <tr><td><code>(type:contract OR type:system) contract:CCW67...</code></td><td><code>{"and":[{"or":[{"type":"contract"},{"type":"system"}]},{"contract":"CCW67..."}]}</code></td></tr>
  </table>

  <h3 id="query-limits">Query Limits</h3>
  <table>
    <tr><th>Limit</th><th>Value</th></tr>
    <tr><td>Max query length</td><td>1,024 bytes</td></tr>
    <tr><td>Max terms (key:value pairs)</td><td>20</td></tr>
    <tr><td>Max parenthesis nesting depth</td><td>4</td></tr>
    <tr><td>Max filter combinations after expansion</td><td>20</td></tr>
  </table>

  <h3 id="response">Response</h3>
  <pre>{
  "object": "list",
  "url": "/events?...",
  "next": "/events?after=evt_...&...",
  "data": [
    {
      "object": "event",
      "id": "evt_yGrddDfumfmdgBDNdtycxRy",
      "url": "/events/evt_yGrddDfumfmdgBDNdtycxRy",
      "ledger": 58000000,
      "at": "2024-01-15T12:00:00+00:00",
      "tx": "abc123...",
      "type": "contract",
      "contract": "CABC...",
      "topics": [{"symbol": "transfer"}],
      "data": {"i128": {"hi": 0, "lo": 1000000}}
    }
  ]
}</pre>

  <h3 id="pagination">Pagination</h3>
  <p>Results are always returned in <strong>descending order</strong> (newest first). Use the <code>before</code> and <code>after</code> cursors to page through events.</p>

  <p><strong>Browsing history</strong> &mdash; page backward through older events:</p>
  <ol>
    <li>Fetch the first page: <code>GET /events?limit=10</code></li>
    <li>The response includes a <code>next</code> field with a cursor.</li>
    <li>Pass it as <code>before</code> to get the next page of older events: <code>GET /events?limit=10&amp;before=evt_...</code></li>
    <li>Repeat until <code>data</code> is empty.</li>
  </ol>

  <p><strong>Streaming new events</strong> &mdash; poll for events newer than the last seen:</p>
  <ol>
    <li>Save the <code>id</code> of the newest event you've seen (the first item in <code>data</code>).</li>
    <li>Poll with <code>after</code>: <code>GET /events?after=evt_...</code></li>
    <li>Any events created since your last seen <code>id</code> are returned, newest first.</li>
  </ol>

  <h3 id="try-it">Try it</h3>
  <div class="tabs" data-group="events-list">
    <button class="tab active" data-tab="latest">Latest</button>
    <button class="tab" data-tab="bytype">By type</button>
    <button class="tab" data-tab="bytopics">By topics</button>
    <button class="tab" data-tab="bycontract">By contract</button>
    <button class="tab" data-tab="byledger">By ledger</button>
    <button class="tab" data-tab="byquery">By query</button>
    <button class="tab" data-tab="pagination">Pagination</button>
  </div>

  <!-- Latest events -->
  <div class="tab-panel active" id="panel-latest">
    <div class="toggle-row">
      <button class="toggle-btn active" data-method="GET" data-panel="latest">GET</button>
      <button class="toggle-btn" data-method="POST" data-panel="latest">POST</button>
    </div>
    <div class="request-get" id="req-get-latest">
      <textarea class="request-area" rows="1">/events?limit=5</textarea>
    </div>
    <div class="request-post" id="req-post-latest" style="display:none">
      <textarea class="request-area" rows="3">{
  "limit": 5
}</textarea>
    </div>
    <div class="curl-area" id="curl-latest">
      <div class="curl-label">curl<span class="copy-hint">click to copy</span></div>
      <pre></pre>
    </div>
    <button class="submit-btn" data-panel="latest">Submit<span class="spinner"></span></button>
    <div class="response-area" id="resp-latest">
      <div class="response-label">Response<span class="response-time"></span></div>
      <pre>Click Submit to send a request.</pre>
    </div>
  </div>

  <!-- Filter by type -->
  <div class="tab-panel" id="panel-bytype">
    <div class="toggle-row">
      <button class="toggle-btn active" data-method="GET" data-panel="bytype">GET</button>
      <button class="toggle-btn" data-method="POST" data-panel="bytype">POST</button>
    </div>
    <div class="request-get" id="req-get-bytype">
      <textarea class="request-area" rows="1">/events?limit=5&q=type:contract</textarea>
    </div>
    <div class="request-post" id="req-post-bytype" style="display:none">
      <textarea class="request-area" rows="4">{
  "limit": 5,
  "q": "type:contract"
}</textarea>
    </div>
    <div class="curl-area" id="curl-bytype">
      <div class="curl-label">curl<span class="copy-hint">click to copy</span></div>
      <pre></pre>
    </div>
    <button class="submit-btn" data-panel="bytype">Submit<span class="spinner"></span></button>
    <div class="response-area" id="resp-bytype">
      <div class="response-label">Response<span class="response-time"></span></div>
      <pre>Click Submit to send a request.</pre>
    </div>
  </div>

  <!-- Filter by topics -->
  <div class="tab-panel" id="panel-bytopics">
    <div class="toggle-row">
      <button class="toggle-btn active" data-method="GET" data-panel="bytopics">GET</button>
      <button class="toggle-btn" data-method="POST" data-panel="bytopics">POST</button>
    </div>
    <div class="request-get" id="req-get-bytopics">
      <textarea class="request-area" rows="1">/events?limit=5&q=type:contract%20topic0:{"symbol":"transfer"}</textarea>
    </div>
    <div class="request-post" id="req-post-bytopics" style="display:none">
      <textarea class="request-area" rows="4">{
  "limit": 5,
  "q": "type:contract topic0:{\"symbol\":\"transfer\"}"
}</textarea>
    </div>
    <div class="curl-area" id="curl-bytopics">
      <div class="curl-label">curl<span class="copy-hint">click to copy</span></div>
      <pre></pre>
    </div>
    <button class="submit-btn" data-panel="bytopics">Submit<span class="spinner"></span></button>
    <div class="response-area" id="resp-bytopics">
      <div class="response-label">Response<span class="response-time"></span></div>
      <pre>Click Submit to send a request.</pre>
    </div>
  </div>

  <!-- Filter by contract -->
  <div class="tab-panel" id="panel-bycontract">
    <div class="toggle-row">
      <button class="toggle-btn active" data-method="GET" data-panel="bycontract">GET</button>
      <button class="toggle-btn" data-method="POST" data-panel="bycontract">POST</button>
    </div>
    <div class="request-get" id="req-get-bycontract">
      <textarea class="request-area" rows="1">/events?limit=5&q=contract:CCW67TSZV3SSS2HXMBQ5JFGCKJNXKZM7UQUWUZPUTHXSTZLEO7SJMI</textarea>
    </div>
    <div class="request-post" id="req-post-bycontract" style="display:none">
      <textarea class="request-area" rows="4">{
  "limit": 5,
  "q": "contract:CCW67TSZV3SSS2HXMBQ5JFGCKJNXKZM7UQUWUZPUTHXSTZLEO7SJMI"
}</textarea>
    </div>
    <div class="curl-area" id="curl-bycontract">
      <div class="curl-label">curl<span class="copy-hint">click to copy</span></div>
      <pre></pre>
    </div>
    <button class="submit-btn" data-panel="bycontract">Submit<span class="spinner"></span></button>
    <div class="response-area" id="resp-bycontract">
      <div class="response-label">Response<span class="response-time"></span></div>
      <pre>Click Submit to send a request.</pre>
    </div>
  </div>

  <!-- With ledger -->
  <div class="tab-panel" id="panel-byledger">
    <div class="toggle-row">
      <button class="toggle-btn active" data-method="GET" data-panel="byledger">GET</button>
      <button class="toggle-btn" data-method="POST" data-panel="byledger">POST</button>
    </div>
    <div class="request-get" id="req-get-byledger">
      <textarea class="request-area" rows="1">/events?limit=5&q=ledger:58000000</textarea>
    </div>
    <div class="request-post" id="req-post-byledger" style="display:none">
      <textarea class="request-area" rows="4">{
  "limit": 5,
  "q": "ledger:58000000"
}</textarea>
    </div>
    <div class="curl-area" id="curl-byledger">
      <div class="curl-label">curl<span class="copy-hint">click to copy</span></div>
      <pre></pre>
    </div>
    <button class="submit-btn" data-panel="byledger">Submit<span class="spinner"></span></button>
    <div class="response-area" id="resp-byledger">
      <div class="response-label">Response<span class="response-time"></span></div>
      <pre>Click Submit to send a request.</pre>
    </div>
  </div>

  <!-- By query -->
  <div class="tab-panel" id="panel-byquery">
    <div class="toggle-row">
      <button class="toggle-btn active" data-method="GET" data-panel="byquery">GET</button>
      <button class="toggle-btn" data-method="POST" data-panel="byquery">POST</button>
    </div>
    <div class="query-input-label">Query (<code>q</code>)</div>
    <textarea class="request-area" id="query-input" rows="2" placeholder="type:contract topic0:{&quot;symbol&quot;:&quot;transfer&quot;}">type:contract</textarea>
    <div class="request-get" id="req-get-byquery">
      <div class="query-input-label" style="margin-top:10px">Path</div>
      <textarea class="request-area" rows="1" readonly>/events?q=type%3Acontract</textarea>
    </div>
    <div class="request-post" id="req-post-byquery" style="display:none">
      <div class="query-input-label" style="margin-top:10px">Body</div>
      <textarea class="request-area" rows="3" readonly>{
  "q": "type:contract"
}</textarea>
    </div>
    <div class="curl-area" id="curl-byquery">
      <div class="curl-label">curl<span class="copy-hint">click to copy</span></div>
      <pre></pre>
    </div>
    <button class="submit-btn" data-panel="byquery">Submit<span class="spinner"></span></button>
    <div class="response-area" id="resp-byquery">
      <div class="response-label">Response<span class="response-time"></span></div>
      <pre>Click Submit to send a request.</pre>
    </div>
  </div>

  <!-- With pagination -->
  <div class="tab-panel" id="panel-pagination">
    <div class="toggle-row">
      <button class="toggle-btn active" data-method="GET" data-panel="pagination">GET</button>
      <button class="toggle-btn" data-method="POST" data-panel="pagination">POST</button>
    </div>
    <div class="request-get" id="req-get-pagination">
      <textarea class="request-area" rows="1">/events?limit=5&after=evt_gvBRkuemgevvRRfRkzRtrTi</textarea>
    </div>
    <div class="request-post" id="req-post-pagination" style="display:none">
      <textarea class="request-area" rows="4">{
  "limit": 5,
  "after": "evt_gvBRkuemgevvRRfRkzRtrTi"
}</textarea>
    </div>
    <div class="curl-area" id="curl-pagination">
      <div class="curl-label">curl<span class="copy-hint">click to copy</span></div>
      <pre></pre>
    </div>
    <button class="submit-btn" data-panel="pagination">Submit<span class="spinner"></span></button>
    <div class="response-area" id="resp-pagination">
      <div class="response-label">Response<span class="response-time"></span></div>
      <pre>Click Submit to send a request.</pre>
    </div>
  </div>

  </div>
</details>

<!-- GET /events/:id -->
<details>
  <summary>
    <span class="method method-get">GET</span>
    <code>/events/:id</code>
    <p>Get a single event by ID</p>
  </summary>
  <div class="endpoint-body">

  <p>Returns a single event object. The <code>:id</code> is the opaque event ID from list responses (e.g. <code>evt_yGrddDfumfmdgBDNdtycxRy</code>).</p>

  <h3 id="event-response">Response</h3>
  <pre>{
  "object": "event",
  "id": "evt_yGrddDfumfmdgBDNdtycxRy",
  "url": "/events/evt_yGrddDfumfmdgBDNdtycxRy",
  "ledger": 58000000,
  "at": "2024-01-15T12:00:00+00:00",
  "tx": "abc123...",
  "type": "contract",
  "contract": "CABC...",
  "topics": [{"symbol": "transfer"}],
  "data": {"i128": {"hi": 0, "lo": 1000000}}
}</pre>

  <h3 id="event-try-it">Try it</h3>
  <div class="request-get" id="req-get-getbyid">
    <textarea class="request-area" rows="1">/events/evt_yGrddDfumfmdgBDNdtycxRy</textarea>
  </div>
  <div class="curl-area" id="curl-getbyid">
    <div class="curl-label">curl<span class="copy-hint">click to copy</span></div>
    <pre></pre>
  </div>
  <button class="submit-btn" data-panel="getbyid" data-method-fixed="GET">Submit<span class="spinner"></span></button>
  <div class="response-area" id="resp-getbyid">
    <div class="response-label">Response<span class="response-time"></span></div>
    <pre>Click Submit to send a request.</pre>
  </div>

  </div>
</details>

<!-- GET /health -->
<details>
  <summary>
    <span class="method method-get">GET</span>
    <code>/health</code>
    <p>Health check and server status</p>
  </summary>
  <div class="endpoint-body">

  <h3 id="health-response">Response</h3>
  <pre>{
  "status": "ok",
  "latest_ledger": 12345,
  "cached_ledgers": 7200,
  "network_passphrase": "..."
}</pre>

  <h3 id="health-try-it">Try it</h3>
  <div class="request-get" id="req-get-health">
    <textarea class="request-area" rows="1">/health</textarea>
  </div>
  <div class="curl-area" id="curl-health">
    <div class="curl-label">curl<span class="copy-hint">click to copy</span></div>
    <pre></pre>
  </div>
  <button class="submit-btn" data-panel="health" data-method-fixed="GET">Submit<span class="spinner"></span></button>
  <div class="response-area" id="resp-health">
    <div class="response-label">Response<span class="response-time"></span></div>
    <pre>Click Submit to send a request.</pre>
  </div>

  </div>
</details>

</div>

<script>
(function() {
  var origin = location.origin;

  function buildCurl(panel) {
    var curlPre = document.querySelector('#curl-' + panel + ' pre');
    if (!curlPre) return;
    var fixedBtn = document.querySelector('.submit-btn[data-panel="' + panel + '"][data-method-fixed]');
    if (fixedBtn) {
      // Simple GET-only panel
      var url = document.querySelector('#req-get-' + panel + ' .request-area').value.trim();
      curlPre.textContent = "curl '" + origin + url + "'";
      return;
    }
    var activeToggle = document.querySelector('.toggle-btn.active[data-panel="' + panel + '"]');
    var method = activeToggle ? activeToggle.dataset.method : 'GET';
    if (method === 'GET') {
      var url = document.querySelector('#req-get-' + panel + ' .request-area').value.trim();
      curlPre.textContent = "curl '" + origin + url + "'";
    } else {
      var body = document.querySelector('#req-post-' + panel + ' .request-area').value.trim();
      curlPre.textContent = "curl -X POST '" + origin + "/events' \\\n  -H 'Content-Type: application/json' \\\n  -d '" + body + "'";
    }
  }

  // Auto-resize a textarea to fit its content.
  function autoResize(ta) {
    ta.style.height = 'auto';
    ta.style.height = ta.scrollHeight + 'px';
  }

  // Build curl for all panels on load
  var panels = ['latest','bytype','bytopics','bycontract','byledger','byquery','pagination','getbyid','health'];
  panels.forEach(buildCurl);

  // Size all textareas on load and auto-resize on input.
  document.querySelectorAll('.request-area').forEach(function(ta) {
    autoResize(ta);
    ta.addEventListener('input', function() { autoResize(ta); });
    ta.addEventListener('paste', function() { setTimeout(function() { autoResize(ta); }, 0); });
  });

  // By-query panel: sync query input to path/body/curl
  var queryInput = document.getElementById('query-input');
  function updateByQueryPanel() {
    var q = queryInput.value.trim();
    var getTA = document.querySelector('#req-get-byquery .request-area');
    var postTA = document.querySelector('#req-post-byquery .request-area');
    if (q) {
      getTA.value = '/events?q=' + encodeURIComponent(q);
      postTA.value = JSON.stringify({ q: q }, null, 2);
    } else {
      getTA.value = '/events';
      postTA.value = '{}';
    }
    autoResize(getTA);
    autoResize(postTA);
    buildCurl('byquery');
  }
  queryInput.addEventListener('input', updateByQueryPanel);
  queryInput.addEventListener('paste', function() { setTimeout(updateByQueryPanel, 0); });

  // "try it" links in examples → prefill By query panel
  document.querySelectorAll('.try-it-link').forEach(function(link) {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      var query = link.nextElementSibling.textContent;
      queryInput.value = query;
      autoResize(queryInput);
      updateByQueryPanel();
      // Switch to the "By query" tab
      var tabGroup = document.querySelector('.tabs[data-group="events-list"]');
      tabGroup.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
      var container = tabGroup.parentElement;
      container.querySelectorAll('.tab-panel').forEach(function(p) { p.classList.remove('active'); });
      tabGroup.querySelector('[data-tab="byquery"]').classList.add('active');
      var panel = document.getElementById('panel-byquery');
      panel.classList.add('active');
      panel.querySelectorAll('.request-area').forEach(autoResize);
      panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  });

  // Copy curl on click
  document.querySelectorAll('.curl-area pre').forEach(function(pre) {
    pre.addEventListener('click', function() {
      navigator.clipboard.writeText(pre.textContent);
      var hint = pre.parentElement.querySelector('.copy-hint');
      hint.textContent = 'copied!';
      setTimeout(function() { hint.textContent = 'click to copy'; }, 1500);
    });
  });

  // Rebuild curl when textarea changes
  document.querySelectorAll('.request-area').forEach(function(ta) {
    function rebuildForTA() {
      var parent = ta.closest('.tab-panel') || ta.closest('.endpoint-body');
      if (!parent) return;
      var respArea = parent.querySelector('.response-area');
      if (respArea) {
        var panelId = respArea.id.replace('resp-', '');
        buildCurl(panelId);
      }
    }
    ta.addEventListener('input', rebuildForTA);
    ta.addEventListener('paste', function() { setTimeout(rebuildForTA, 0); });
  });

  // Tabs (scoped to tab groups)
  document.querySelectorAll('.tabs').forEach(function(tabGroup) {
    tabGroup.addEventListener('click', function(e) {
      var btn = e.target.closest('.tab');
      if (!btn) return;
      tabGroup.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
      // Find sibling panels
      var container = tabGroup.parentElement;
      container.querySelectorAll('.tab-panel').forEach(function(p) { p.classList.remove('active'); });
      btn.classList.add('active');
      var activePanel = container.querySelector('#panel-' + btn.dataset.tab);
      activePanel.classList.add('active');
      activePanel.querySelectorAll('.request-area').forEach(autoResize);
    });
  });

  // GET/POST toggle
  document.querySelectorAll('.toggle-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var panel = btn.dataset.panel;
      var method = btn.dataset.method;
      document.querySelectorAll('.toggle-btn[data-panel="' + panel + '"]').forEach(function(b) {
        b.classList.remove('active');
      });
      btn.classList.add('active');
      var getEl = document.getElementById('req-get-' + panel);
      var postEl = document.getElementById('req-post-' + panel);
      if (method === 'GET') {
        getEl.style.display = '';
        postEl.style.display = 'none';
        getEl.querySelectorAll('.request-area').forEach(autoResize);
      } else {
        getEl.style.display = 'none';
        postEl.style.display = '';
        postEl.querySelectorAll('.request-area').forEach(autoResize);
      }
      buildCurl(panel);
    });
  });

  // Resize textareas when a collapsed <details> is opened.
  document.querySelectorAll('details').forEach(function(d) {
    d.addEventListener('toggle', function() {
      if (d.open) {
        d.querySelectorAll('.request-area').forEach(autoResize);
      }
    });
  });

  // Build info
  fetch('/health')
    .then(function(r) { return r.json(); })
    .then(function(data) {
      var b = data.build;
      if (!b || !b.repo) return;
      var el = document.getElementById('build-info');
      var commitShort = b.commit ? b.commit.substring(0, 7) : '';
      var html = '<a href="' + b.repo + '" target="_blank" rel="noopener">'
        + '<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>'
        + b.repo.replace('https://github.com/', '')
        + '</a>';
      if (b.branch) {
        html += '<span class="sep">/</span><a href="' + b.repo + '/tree/' + b.branch + '" target="_blank" rel="noopener"><code>' + b.branch + '</code></a>';
      }
      if (b.pr) {
        html += '<span class="sep">#</span><a href="' + b.repo + '/pull/' + b.pr + '" target="_blank" rel="noopener"><code>' + b.pr + '</code></a>';
      }
      if (commitShort) {
        html += '<span class="sep">@</span><a href="' + b.repo + '/commit/' + b.commit + '" target="_blank" rel="noopener"><code>' + commitShort + '</code></a>';
      }
      el.innerHTML = html;
    })
    .catch(function() {});

  // Submit
  document.querySelectorAll('.submit-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var panel = btn.dataset.panel;
      var respPre = document.querySelector('#resp-' + panel + ' pre');
      var timeSpan = document.querySelector('#resp-' + panel + ' .response-time');
      var spinner = btn.querySelector('.spinner');

      btn.disabled = true;
      spinner.style.display = 'inline-block';
      respPre.textContent = 'Loading...';
      timeSpan.textContent = '';

      var opts = {};
      var url;

      if (btn.dataset.methodFixed) {
        // Simple GET-only panel
        var textarea = document.querySelector('#req-get-' + panel + ' .request-area');
        url = textarea.value.trim();
        opts.method = 'GET';
      } else {
        var activeToggle = document.querySelector('.toggle-btn.active[data-panel="' + panel + '"]');
        var method = activeToggle ? activeToggle.dataset.method : 'GET';
        if (method === 'GET') {
          var textarea = document.querySelector('#req-get-' + panel + ' .request-area');
          url = textarea.value.trim();
          opts.method = 'GET';
        } else {
          url = '/events';
          var textarea = document.querySelector('#req-post-' + panel + ' .request-area');
          var body = textarea.value.trim();
          opts.method = 'POST';
          opts.headers = { 'Content-Type': 'application/json' };
          opts.body = body;
        }
      }

      var t0 = performance.now();
      fetch(url, opts)
        .then(function(r) { return r.text(); })
        .then(function(text) {
          var ms = Math.round(performance.now() - t0);
          timeSpan.textContent = ms + ' ms';
          try {
            var json = JSON.parse(text);
            respPre.textContent = JSON.stringify(json, null, 2);
          } catch(e) {
            respPre.textContent = text;
          }
        })
        .catch(function(err) {
          var ms = Math.round(performance.now() - t0);
          timeSpan.textContent = ms + ' ms';
          respPre.textContent = 'Error: ' + err.message;
        })
        .finally(function() {
          btn.disabled = false;
          spinner.style.display = 'none';
        });
    });
  });
})();
</script>
</body>
</html>
